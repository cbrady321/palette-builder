<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Palette Builder</title>
    <style>
        body {
            font-family: "Inter", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: black;
            font-size: 15px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        .palette {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .palette-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .palette-name {
            font-size: 18px;
            font-weight: bold;
            border: none;
            background: transparent;
            padding: 5px;
        }
        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0;
        }
        .color-patch {
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .color-patch:nth-child(3n-2):first-child { border-top-left-radius: 8px; }
        .color-patch:nth-child(3n):nth-child(-n+3) { border-top-right-radius: 8px; }
        .color-patch:nth-child(3n-2):nth-last-child(-n+3) { border-bottom-left-radius: 8px; }
        .color-patch:nth-child(3n):last-child { border-bottom-right-radius: 8px; }
        .color-code {
            font-size: 14px;
            padding: 4px 8px;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
        }
        .ellipsis-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        .ellipsis-button:hover {
            background-color: rgba(0,0,0,0.1);
            border-radius: 50%;
        }
        .add-button, .export-button, .import-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .add-button:hover, .export-button:hover, .import-button:hover {
            background-color: #45a049;
        }
        .export-button { background-color: #2196F3; }
        .export-button:hover { background-color: #1e87db; }
        .import-button { background-color: #FF9800; }
        .import-button:hover { background-color: #e68a00; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #configTextarea {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
        }
        .color-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 0;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .color-menu button {
            display: block;
            width: 100%;
            padding: 8px 10px;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .color-menu button:hover {
            background-color: #f0f0f0;
        }
        @media (max-width: 768px) {
            .color-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .color-patch:nth-child(2n-1):first-child { border-top-left-radius: 8px; }
            .color-patch:nth-child(2n):nth-child(-n+2) { border-top-right-radius: 8px; }
            .color-patch:nth-child(2n-1):nth-last-child(-n+2) { border-bottom-left-radius: 8px; }
            .color-patch:nth-child(2n):last-child { border-bottom-right-radius: 8px; }
        }
        @media (max-width: 480px) {
            .color-grid {
                grid-template-columns: 1fr;
            }
            .color-patch:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
            .color-patch:last-child { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="addPaletteBtn" class="add-button">+ Add Palette</button>
        <button id="exportBtn" class="export-button">Export</button>
        <button id="importBtn" class="import-button">Import</button>
        <div id="palettesContainer"></div>
    </div>

    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Export Configuration</h2>
            <textarea id="configTextarea" readonly></textarea>
        </div>
    </div>

    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Import Configuration</h2>
            <textarea id="importTextarea"></textarea>
            <button id="applyImportBtn" class="add-button">Apply</button>
        </div>
    </div>

    <div id="colorMenu" class="color-menu">
        <button id="openPickerBtn">Open Color Picker</button>
        <button id="deleteColorBtn">Delete Color</button>
    </div>

    <script>
        const defaultColors = ['#000000', '#FF0000', '#000080', '#FFFF00', '#FFFFFF'];

        class ColorPalette {
            constructor(name = 'New Palette', colors = [...defaultColors]) {
                this.name = name;
                this.colors = colors;
            }

            createElement() {
                const paletteElement = document.createElement('div');
                paletteElement.className = 'palette';
                paletteElement.innerHTML = `
                    <div class="palette-header">
                        <input class="palette-name" value="${this.name}">
                        <button class="add-button add-color-btn">+ Add Color</button>
                    </div>
                    <div class="color-grid"></div>
                `;

                const colorGrid = paletteElement.querySelector('.color-grid');
                this.colors.forEach(color => {
                    colorGrid.appendChild(this.createColorPatch(color));
                });

                paletteElement.querySelector('.add-color-btn').addEventListener('click', () => this.addColor());
                paletteElement.querySelector('.palette-name').addEventListener('change', (e) => this.name = e.target.value);

                return paletteElement;
            }

            createColorPatch(color) {
                const patch = document.createElement('div');
                patch.className = 'color-patch';
                patch.style.backgroundColor = color;
                patch.innerHTML = `
                    <button class="ellipsis-button">â‹®</button>
                    <span class="color-code">${this.rgbToHex(color)}</span>
                `;

                const colorCode = patch.querySelector('.color-code');
                const isLight = this.isColorLight(color);
                colorCode.style.color = isLight ? 'black' : 'white';

                const ellipsisButton = patch.querySelector('.ellipsis-button');
                ellipsisButton.style.color = isLight ? 'black' : 'white';

                ellipsisButton.addEventListener('click', (e) => this.openColorMenu(e, patch));

                return patch;
            }

            isColorLight(color) {
                const hex = color.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                const brightness = ((r * 299) + (g * 587) + (b * 114)) / 1000;
                return brightness > 155;
            }

            openColorMenu(event, patch) {
                event.stopPropagation();
                const menu = document.getElementById('colorMenu');
                menu.style.display = 'block';
                menu.style.left = `${event.pageX}px`;
                menu.style.top = `${event.pageY}px`;

                const openPickerBtn = document.getElementById('openPickerBtn');
                const deleteColorBtn = document.getElementById('deleteColorBtn');

                openPickerBtn.onclick = () => {
                    menu.style.display = 'none';
                    this.openColorPicker(patch);
                };

                deleteColorBtn.onclick = () => {
                    menu.style.display = 'none';
                    this.deleteColor(patch);
                };

                document.addEventListener('click', () => {
                    menu.style.display = 'none';
                }, { once: true });
            }

            openColorPicker(patch) {
                const input = document.createElement('input');
                input.type = 'color';
                input.value = this.rgbToHex(patch.style.backgroundColor);
                
                const hexInput = document.createElement('input');
                hexInput.type = 'text';
                hexInput.value = this.rgbToHex(patch.style.backgroundColor);
                hexInput.style.position = 'absolute';
                hexInput.style.left = '-9999px';

                document.body.appendChild(hexInput);
                hexInput.select();
                
                input.click();

                input.addEventListener('change', () => {
                    const newColor = input.value;
                    this.updatePatchColor(patch, newColor);
                });

                document.body.removeChild(hexInput);
            }

            rgbToHex(color) {
                if (color.startsWith('#')) {
                    return color.toUpperCase();
                }
                const [r, g, b] = color.match(/\d+/g);
                return "#" + ((1 << 24) + (parseInt(r) << 16) + (parseInt(g) << 8) + parseInt(b)).toString(16).slice(1).toUpperCase();
            }

            updatePatchColor(patch, newColor) {
                patch.style.backgroundColor = newColor;
                const colorCode = patch.querySelector('.color-code');
                colorCode.textContent = this.rgbToHex(newColor);
                colorCode.style.color = this.isColorLight(newColor) ? 'black' : 'white';
                patch.querySelector('.ellipsis-button').style.color = this.isColorLight(newColor) ? 'black' : 'white';
                this.updateColors();
            }

            deleteColor(patch) {
                const colorGrid = patch.parentElement;
                colorGrid.removeChild(patch);
                this.updateColors();
            }

            addColor() {
                const newColor = '#000000';
                const colorGrid = document.querySelector('.color-grid');
                colorGrid.appendChild(this.createColorPatch(newColor));
                this.updateColors();
            }

            updateColors() {
                const patches = document.querySelectorAll('.color-patch');
                this.colors = Array.from(patches).map(patch => patch.style.backgroundColor);
            }
        }

        function addPalette(name = 'New Palette', colors = [...defaultColors]) {
            const palette = new ColorPalette(name, colors);
            const paletteElement = palette.createElement();
            document.getElementById('palettesContainer').appendChild(paletteElement);
        }

        document.getElementById('addPaletteBtn').addEventListener('click', () => addPalette());

        function exportConfig() {
            const palettes = document.querySelectorAll('.palette');
            const config = Array.from(palettes).map(palette => ({
                name: palette.querySelector('.palette-name').value,
                colors: Array.from(palette.querySelectorAll('.color-patch'))
                    .map(patch => patch.style.backgroundColor)
            }));
            return JSON.stringify(config, null, 2);
        }

        function importConfig(configJson) {
            try {
                const config = JSON.parse(configJson);
                document.getElementById('palettesContainer').innerHTML = '';
                config.forEach(palette => addPalette(palette.name, palette.colors));
            } catch (error) {
                console.error('Invalid configuration:', error);
                alert('Invalid configuration. Please check the format and try again.');
            }
        }

        // Export button functionality
        document.getElementById('exportBtn').addEventListener('click', () => {
            const modal = document.getElementById('exportModal');
            const configTextarea = document.getElementById('configTextarea');
            configTextarea.value = exportConfig();
            modal.style.display = 'block';
        });

        // Import button functionality
        document.getElementById('importBtn').addEventListener('click', () => {
            const modal = document.getElementById('importModal');
            modal.style.display = 'block';
        });

        document.getElementById('applyImportBtn').addEventListener('click', () => {
            const configJson = document.getElementById('importTextarea').value;
            importConfig(configJson);
            document.getElementById('importModal').style.display = 'none';
        });

        // Close modal functionality
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', () => {
                closeBtn.closest('.modal').style.display = 'none';
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // Initialize with one palette
        addPalette();
    </script>
</body>
</html>

